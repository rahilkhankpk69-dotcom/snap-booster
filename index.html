<!DOCTYPE html>
<html>
<head>
  <title>Snap Score Booster</title>
</head>
<body>

<h2>Sign Up</h2>
<input id="email" placeholder="Email"><br><br>
<input id="password" placeholder="Password"><br><br>
<input id="username" placeholder="Username"><br><br>
<button onclick="signup()">Sign Up</button>

<h2>Login</h2>
<input id="loginEmail" placeholder="Email"><br><br>
<input id="loginPassword" placeholder="Password"><br><br>
<button onclick="login()">Login</button>

<p id="msg"></p>

<div id="scoreSection" style="display:none;">
  <h2>Your Snap Score</h2>
  <p id="score">0</p>
  <button onclick="boost()">Boost Score</button>
</div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
const supabaseUrl = "https://mdcsbpbrcvudxbdjchwt.supabase.co";
const supabaseKey = "sb_publishable_jqIhtEIHIqtwYCmx5cpKsQ_0GwVPr6X";
const supabase = supabase.createClient(supabaseUrl, supabaseKey);

let currentUser = null;

// SIGNUP
async function signup() {
  const email = document.getElementById("email").value;
  const password = document.getElementById("password").value;
  const username = document.getElementById("username").value;

  const { data, error } = await supabase.auth.signUp({
    email,
    password
  });

  if (error) {
    document.getElementById("msg").innerText = error.message;
    return;
  }

  await supabase.from("profiles").insert({
    id: data.user.id,
    username: username,
    score: 0
  });

  document.getElementById("msg").innerText = "Signup successful!";
}

// LOGIN
async function login() {
  const email = document.getElementById("loginEmail").value;
  const password = document.getElementById("loginPassword").value;

  const { data, error } = await supabase.auth.signInWithPassword({
    email,
    password
  });

  if (error) {
    document.getElementById("msg").innerText = error.message;
    return;
  }

  currentUser = data.user;

  const { data: profile } = await supabase
    .from("profiles")
    .select("score")
    .eq("id", currentUser.id)
    .single();

  document.getElementById("score").innerText = profile.score;
  document.getElementById("scoreSection").style.display = "block";
}

// BOOST SCORE
async function boost() {
  let newScore = Math.floor(Math.random() * 10000) + 1000;

  await supabase
    .from("profiles")
    .update({ score: newScore })
    .eq("id", currentUser.id);

  document.getElementById("score").innerText = newScore;
}
</script>

</body>
</html>
